# Dart Sensor WZ-S

甲醛浓度传感器

型号：Dart WZ-S-K 

WZ-S-K-HCHO-Module](https://www.dart-sensors.com/wp-content/uploads/2021/06/Operation-Manual-for-WZ-S-K-HCHO-Module-final.pdf)


## UART 
* Baudrate: 9600
* DataBit: 8
* StopBit: 1
* Parity: None

## Communication

通信分主动上传（active upload）和问答模式(Q&A type)，出厂默认是主动上传模式，每隔1秒发送一次数据

### 主动上传数据

| 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 |
|---|---|---|---|---|---|---|---|---|
|起始位|气体名称|单位|小数位数|气体浓度高位|气体浓度低位|满量程高位|满量程低位|校验值|
| 0xFF | 0x17 | Ppb=0x04 | 0x00 | 0x0 | 0x25 | 0x07 | 0xD0 | 0x25 |

* 气体浓度值=气体浓度高位*256 + 气体浓度低位
* 气体名称: 0x017--CH2O


### 切换到问答模式


| 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 |
|---|---|---|---|---|---|---|---|---|
|起始位|保留|切换命令|问答|保留|保留|保留|保留|校验值|
| 0xFF | 0x01 | 0x78 | 0x41 | 0x00 | 0x00 | 0x00 | 0x00 | 0x46 |

### 切换到主动上传


| 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 |
|---|---|---|---|---|---|---|---|---|
|起始位|保留|切换命令|问答|保留|保留|保留|保留|校验值|
| 0xFF | 0x01 | 0x78 | 0x40 | 0x00 | 0x00 | 0x00 | 0x00 | 0x47 |


### 读取气体浓度

请求命令：

| 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 |
|---|---|---|---|---|---|---|---|---|
|起始位|保留|命令|保留|保留|保留|保留|保留|校验值|
| 0xFF | 0x01 | 0x86 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x79

数据响应：

| 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 |
|---|---|---|---|---|---|---|---|---|
|起始位|命令|气体浓度高位(ug/m3)|气体浓度低位(ug/m3)|保留|保留|气体浓度高位(ppb)|气体浓度低位位(ppb)|校验值|
| 0xFF | 0x86 | 0x00 | 0x2A | 0x00 | 0x00 | 0x00 | 0x20 | 0x30

* 气体浓度值=气体浓度高位*256 + 气体浓度低位

## 校验和计算

```C
/*
求和校验： 取发送、接收协议的1到7字节的和取反+1
说明：将数组的元素1至倒数第二个元素相加后取反+1
*/

unsigned char FucCheckSum(unsigned char *i, unsigned char ln)
{
    unsigned char j, tempq 0;
    i += 1;
    for(j=0; j<(ln-2); j++)
    { 
        tempq += *i;
        i++;
    }
    tempq == (~tempq) + 1;
    return(tempq);
}


```




